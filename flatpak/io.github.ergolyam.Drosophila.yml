app-id: io.github.ergolyam.Drosophila
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.freedesktop.Sdk//24.08
command: yggui

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=network
  - --own-name=io.github.ergolyam.Drosophila
  - --talk-name=org.freedesktop.Flatpak
  - --filesystem=xdg-run/yggui:create

add-extensions:
  org.freedesktop.Sdk.Extension.python3: {}

sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
build-options:
  append-path: /usr/lib/sdk/golang/bin

modules:
  - python3-modules.yaml
  - name: yggdrasil
    buildsystem: simple
    build-options:
      env:
        CGO_ENABLED: "0"
        GOFLAGS: "-mod=vendor"
    build-commands:
      - install -Dm644 yggdrasil-modules.txt vendor/modules.txt
      - ./build
      - install -Dm755 yggdrasil     /app/bin/yggdrasil
      - install -Dm755 yggdrasilctl  /app/bin/yggdrasilctl
    sources:
      - type: git
        url: https://github.com/yggdrasil-network/yggdrasil-go.git
        tag: v0.5.12

      - path: yggdrasil-modules.txt
        type: file
      - dest: vendor/github.com/Arceliar/ironwood
        sha256: 45ec0f8687199b31908bdbe0034f3d92f2ed307221021bc7d6ea2184834d0555
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/!arceliar/ironwood/@v/v0.0.0-20241213013129-743fe2fccbd3.zip
      - dest: vendor/github.com/Arceliar/phony
        sha256: 015391bd77b8eb93d4e0baa42d93b0734cb152a69ab1222d7221070a0b020b59
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/!arceliar/phony/@v/v0.0.0-20220903101357-530938a4b13d.zip
      - dest: vendor/github.com/cheggaaa/pb/v3
        sha256: 33e07fb4c6a4fadef18d0caf0968362c2727d432ad0cb8d5d031e61e260aa5f6
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/cheggaaa/pb/v3/@v/v3.1.5.zip
      - dest: vendor/github.com/coder/websocket
        sha256: ad8d323970c04679f4566ee7db98946508c37cdd21a46a875d5257d631a9e990
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/coder/websocket/@v/v1.8.12.zip
      - dest: vendor/github.com/gologme/log
        sha256: 051a6b22558a6e978dbcdf94c90a06811a57c53f1d5a6da0215da0339b684295
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/gologme/log/@v/v1.3.0.zip
      - dest: vendor/github.com/hashicorp/go-syslog
        sha256: a0ca8b61ea365e9ecdca513b94f200aef3ff68b4c95d9dabc88ca25fcb33bce6
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/hashicorp/go-syslog/@v/v1.0.0.zip
      - dest: vendor/github.com/hjson/hjson-go/v4
        sha256: eb9463ccc676496f1acbd2c5c598c2e6dcf57f21f2b0c1dee8e934e9487d5571
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/hjson/hjson-go/v4/@v/v4.4.0.zip
      - dest: vendor/github.com/kardianos/minwinsvc
        sha256: 1518d4091dde92e9e68fa01b8145473a719387fb9f34765a920cc49d18dcf316
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/kardianos/minwinsvc/@v/v1.0.2.zip
      - dest: vendor/github.com/quic-go/quic-go
        sha256: 39d5e0be634c55af4c407606c108f1ae1fa58158ce8a433d71ad25fc2c8b9642
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/quic-go/quic-go/@v/v0.48.2.zip
      - dest: vendor/github.com/vishvananda/netlink
        sha256: 370bda84888ff8e7768e0bae783c8e45a1bf8a02e596a0bb0dc98712b5d42453
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/vishvananda/netlink/@v/v1.3.0.zip
      - dest: vendor/github.com/wlynxg/anet
        sha256: 5d6e471ccaa553e0cac56e17f8e44499f99ca1a1e37d80d5fdb3c64d4d50d02a
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/wlynxg/anet/@v/v0.0.5.zip
      - dest: vendor/golang.org/x/crypto
        sha256: 7cbc5fbc206b07db3c691ad59bc1b31f2c32a1dae2b04c9a7772f93a696381bf
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/crypto/@v/v0.31.0.zip
      - dest: vendor/golang.org/x/net
        sha256: ced2b8369a529613741b5bfe1f0df0dc98545d9203341cfcef5f824cdd961016
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/net/@v/v0.32.0.zip
      - dest: vendor/golang.org/x/sys
        sha256: 0ed47a83fe7d7a7e743e815172bc10c1ac0ed0d31ebb095e75717428e09aa895
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/sys/@v/v0.28.0.zip
      - dest: vendor/golang.org/x/text
        sha256: be3db791651af6f2cb0225aa5d5578c23149b2017246ba8e59586080baadd612
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/text/@v/v0.21.0.zip
      - dest: vendor/golang.zx2c4.com/wintun
        sha256: 06599222daa6af8547045c446cefa9a2bab19d57bde1fc6436114308d79a2b4b
        strip-components: 2
        type: archive
        url: https://proxy.golang.org/golang.zx2c4.com/wintun/@v/v0.0.0-20230126152724-0fa3db229ce2.zip
      - dest: vendor/golang.zx2c4.com/wireguard
        sha256: 7f219b9558a79fe122ea35b0e16fbef5cb2010d32821861e17ba962df135065f
        strip-components: 2
        type: archive
        url: https://proxy.golang.org/golang.zx2c4.com/wireguard/@v/v0.0.0-20231211153847-12269c276173.zip
      - dest: vendor/golang.zx2c4.com/wireguard/windows
        sha256: e2d55170e777024f0847c625a9d90520e90e31128fa8525c67bc5daacaeb55ed
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.zx2c4.com/wireguard/windows/@v/v0.5.3.zip
      - dest: vendor/github.com/bits-and-blooms/bitset
        sha256: e84f02c05b880ea9f289032f89e2fcb5107ca9f77fa452f1fd5cc3030f6189d2
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/bits-and-blooms/bitset/@v/v1.13.0.zip
      - dest: vendor/github.com/bits-and-blooms/bloom/v3
        sha256: f6d7b6b1a1d86673f389242c8cd94a53547db89c26ca9cab82d5ff13e716fbf4
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/bits-and-blooms/bloom/v3/@v/v3.7.0.zip
      - dest: vendor/github.com/go-task/slim-sprig
        sha256: 25a036dc8eb9f6227c2df818916f76db93eebbac88cc24bad5c960b0c60d7a08
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/go-task/slim-sprig/@v/v0.0.0-20230315185526-52ccab3ef572.zip
      - dest: vendor/github.com/google/pprof
        sha256: e762c4985bb07033263c5f83dcd5543a16d0e778dee23be1404b0cb4dfba2aaa
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/google/pprof/@v/v0.0.0-20210407192527-94a9f03dee38.zip
      - dest: vendor/github.com/mattn/go-colorable
        sha256: 08be322dcc584a9fcfde5caf0cf878b4e11cd98f252e32bc704e92c5a4ba9d15
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/mattn/go-colorable/@v/v0.1.13.zip
      - dest: vendor/github.com/onsi/ginkgo/v2
        sha256: e94cc126e2b7d8f71d1b4ee945b5b9e72ed20a6bc6103451531994a7d3be1c3b
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/onsi/ginkgo/v2/@v/v2.9.5.zip
      - dest: vendor/github.com/rivo/uniseg
        sha256: 3199d94be50284142220662ca3b00e19ddd1debe4e80ddc745ff4203ecb601c0
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/rivo/uniseg/@v/v0.2.0.zip
      - dest: vendor/go.uber.org/mock
        sha256: 29c088ba1621e04fba8670e388e962f92c15f47cd45a63bf0e5decd6d5d63cd1
        strip-components: 2
        type: archive
        url: https://proxy.golang.org/go.uber.org/mock/@v/v0.4.0.zip
      - dest: vendor/golang.org/x/exp
        sha256: 8232d7fe1ac8f2d9f05cdce15c7fa64f0c54c6dd35256c5312c1381d1d1eca79
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/exp/@v/v0.0.0-20240719175910-8a7402abbf56.zip
      - dest: vendor/golang.org/x/mod
        sha256: f98b5d576225d13dac6945afc53bc79cb66ad3ebd9a4eacdefbf629f4d20ea44
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/mod/@v/v0.19.0.zip
      - dest: vendor/golang.org/x/sync
        sha256: 94ea75ea625ecb8d81ab473a2d7e03433e63083768cd27d48a03f8c1c9da3d8d
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/sync/@v/v0.10.0.zip
      - dest: vendor/golang.org/x/tools
        sha256: 9ca4cd082f8dc3a265f8020d6ac581078d902878ca40bba56d5e672b56209aec
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/tools/@v/v0.23.0.zip
      - dest: vendor/github.com/VividCortex/ewma
        sha256: facfeeec2dac447211e733ed6f190e9068a8a89d770ea40b1d6955fa6cff36cf
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/!vivid!cortex/ewma/@v/v1.2.0.zip
      - dest: vendor/github.com/fatih/color
        sha256: 4dc6907b7f6807b37c21ad527d966437d398f03472115f471eaa8fe5875363d3
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/fatih/color/@v/v1.18.0.zip
      - dest: vendor/github.com/mattn/go-isatty
        sha256: f2d5f89ca451577e17464b9bb596dc0d0ecececb5eaa63622c41b57cd0b7b8cc
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/mattn/go-isatty/@v/v0.0.20.zip
      - dest: vendor/github.com/mattn/go-runewidth
        sha256: 179d2d900c76ee3560fbeda60d0237a3be6acb734d0cb7423b55e5ccb0cedbca
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/mattn/go-runewidth/@v/v0.0.16.zip
      - dest: vendor/github.com/olekukonko/tablewriter
        sha256: ba678c0fddd0645293afc2ac50a5943730d755e31059f588f4b4a8c581b65dad
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/olekukonko/tablewriter/@v/v0.0.5.zip
      - dest: vendor/github.com/vishvananda/netns
        sha256: 07804b88c922c2a6780efe392ffef9d126eac584384eb3eb17bcadd34cfa9422
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/vishvananda/netns/@v/v0.0.5.zip
      - dest: vendor/suah.dev/protect
        sha256: 8cf4a6bdbd43452b9011c4a9dd61e2f664bb6eaa9e317178b0577d93cc7f792b
        strip-components: 2
        type: archive
        url: https://proxy.golang.org/suah.dev/protect/@v/v1.2.4.zip

  - name: yggstack
    buildsystem: simple
    build-options:
      env:
        CGO_ENABLED: "0"
        GOFLAGS: "-mod=vendor"
    build-commands:
      - install -Dm644 yggstack-modules.txt vendor/modules.txt
      - ./build
      - install -Dm755 yggstack /app/bin/yggstack
    sources:
      - type: git
        url: https://github.com/yggdrasil-network/yggstack.git
        commit: "8ad1962f6456a81a6ec5a9b41fd0985f4b5768fe"

      - path: yggstack-modules.txt
        type: file
      - dest: vendor/github.com/gologme/log
        sha256: 051a6b22558a6e978dbcdf94c90a06811a57c53f1d5a6da0215da0339b684295
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/gologme/log/@v/v1.3.0.zip
      - dest: vendor/github.com/hashicorp/go-syslog
        sha256: a0ca8b61ea365e9ecdca513b94f200aef3ff68b4c95d9dabc88ca25fcb33bce6
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/hashicorp/go-syslog/@v/v1.0.0.zip
      - dest: vendor/github.com/hjson/hjson-go/v4
        sha256: eb9463ccc676496f1acbd2c5c598c2e6dcf57f21f2b0c1dee8e934e9487d5571
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/hjson/hjson-go/v4/@v/v4.4.0.zip
      - dest: vendor/github.com/things-go/go-socks5
        sha256: f488adffb29b9b4f0ace6965097c854db4727b196e22aefe919eca6edf448461
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/things-go/go-socks5/@v/v0.0.5.zip
      - dest: vendor/github.com/yggdrasil-network/yggdrasil-go
        sha256: a2cb967dd99ac93ee929be5609ec657fef694cd29d89e3597797ef6f9bb410fd
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/yggdrasil-network/yggdrasil-go/@v/v0.5.12.zip
      - dest: vendor/gvisor.dev/gvisor
        sha256: 5d6e8ea997783f6a546d27c7476a7dcb0ff806a5f32a25af193aad1f252fbc09
        strip-components: 2
        type: archive
        url: https://proxy.golang.org/gvisor.dev/gvisor/@v/v0.0.0-20240810013311-326fe0f2a77f.zip
      - dest: vendor/github.com/Arceliar/ironwood
        sha256: 45ec0f8687199b31908bdbe0034f3d92f2ed307221021bc7d6ea2184834d0555
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/!arceliar/ironwood/@v/v0.0.0-20241213013129-743fe2fccbd3.zip
      - dest: vendor/github.com/Arceliar/phony
        sha256: 015391bd77b8eb93d4e0baa42d93b0734cb152a69ab1222d7221070a0b020b59
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/!arceliar/phony/@v/v0.0.0-20220903101357-530938a4b13d.zip
      - dest: vendor/github.com/bits-and-blooms/bitset
        sha256: 29542828d3fa62199ac8fe6b69ed5284502b52549e1c64dcdbeeed4eab981a37
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/bits-and-blooms/bitset/@v/v1.14.3.zip
      - dest: vendor/github.com/bits-and-blooms/bloom/v3
        sha256: f6d7b6b1a1d86673f389242c8cd94a53547db89c26ca9cab82d5ff13e716fbf4
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/bits-and-blooms/bloom/v3/@v/v3.7.0.zip
      - dest: vendor/github.com/coder/websocket
        sha256: ad8d323970c04679f4566ee7db98946508c37cdd21a46a875d5257d631a9e990
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/coder/websocket/@v/v1.8.12.zip
      - dest: vendor/github.com/go-task/slim-sprig/v3
        sha256: 5e534ccb4157d0443f65f06b76bce67eb92b3e34766f3a14dabe86945955dbe7
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/go-task/slim-sprig/v3/@v/v3.0.0.zip
      - dest: vendor/github.com/google/btree
        sha256: 11b736bc8252b52fecdf346d3707ccf3a2b6d458ba21b4f843616fc12eeb30b2
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/google/btree/@v/v1.1.3.zip
      - dest: vendor/github.com/google/pprof
        sha256: 620293476cf16b159f0a54b52cf666c45e1697d4c2ad23351bc5b1637bd1aa60
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/google/pprof/@v/v0.0.0-20241017200806-017d972448fc.zip
      - dest: vendor/github.com/onsi/ginkgo/v2
        sha256: eeae43f0710f762731a74f0d6849a70c5f4c7403eacb0f003b11bb3875cd2f66
        strip-components: 4
        type: archive
        url: https://proxy.golang.org/github.com/onsi/ginkgo/v2/@v/v2.20.2.zip
      - dest: vendor/github.com/quic-go/quic-go
        sha256: 39d5e0be634c55af4c407606c108f1ae1fa58158ce8a433d71ad25fc2c8b9642
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/quic-go/quic-go/@v/v0.48.2.zip
      - dest: vendor/github.com/wlynxg/anet
        sha256: 5d6e471ccaa553e0cac56e17f8e44499f99ca1a1e37d80d5fdb3c64d4d50d02a
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/github.com/wlynxg/anet/@v/v0.0.5.zip
      - dest: vendor/go.uber.org/mock
        sha256: 2ac483710c9e6641baf6c9a4d692912d36967a5ebf1e38d47340507d4b882345
        strip-components: 2
        type: archive
        url: https://proxy.golang.org/go.uber.org/mock/@v/v0.5.0.zip
      - dest: vendor/golang.org/x/crypto
        sha256: 7cbc5fbc206b07db3c691ad59bc1b31f2c32a1dae2b04c9a7772f93a696381bf
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/crypto/@v/v0.31.0.zip
      - dest: vendor/golang.org/x/exp
        sha256: a855abb628f058ba7fc33e7b6c46552f2fe0b86bc70c9507982f77b0826e2fa0
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/exp/@v/v0.0.0-20241009180824-f66d83c29e7c.zip
      - dest: vendor/golang.org/x/mod
        sha256: e736e1acca78c9550fa78f54de78d9cf15d5db1ca7d92537900c8591e6ab79c0
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/mod/@v/v0.21.0.zip
      - dest: vendor/golang.org/x/net
        sha256: ced2b8369a529613741b5bfe1f0df0dc98545d9203341cfcef5f824cdd961016
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/net/@v/v0.32.0.zip
      - dest: vendor/golang.org/x/sync
        sha256: 94ea75ea625ecb8d81ab473a2d7e03433e63083768cd27d48a03f8c1c9da3d8d
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/sync/@v/v0.10.0.zip
      - dest: vendor/golang.org/x/sys
        sha256: 0ed47a83fe7d7a7e743e815172bc10c1ac0ed0d31ebb095e75717428e09aa895
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/sys/@v/v0.28.0.zip
      - dest: vendor/golang.org/x/text
        sha256: be3db791651af6f2cb0225aa5d5578c23149b2017246ba8e59586080baadd612
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/text/@v/v0.21.0.zip
      - dest: vendor/golang.org/x/time
        sha256: ce9157f4961055bd942bbb02666ca5be9f92c92f8e64361aede9d1090df44464
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/time/@v/v0.7.0.zip
      - dest: vendor/golang.org/x/tools
        sha256: 2e7f4eff4d5d5834c92f8aa59e44a889af5795c3fa8d1e146fc8224c778aefb5
        strip-components: 3
        type: archive
        url: https://proxy.golang.org/golang.org/x/tools/@v/v0.26.0.zip

  - name: yggui
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation --no-cache-dir --no-deps --prefix=/app .
      - install -Dm644 xdg/io.github.ergolyam.Drosophila.svg /app/share/icons/hicolor/scalable/apps/io.github.ergolyam.Drosophila.svg
      - install -Dm755 xdg/io.github.ergolyam.Drosophila.desktop /app/share/applications/io.github.ergolyam.Drosophila.desktop
      - install -Dm644 xdg/io.github.ergolyam.Drosophila.metainfo.xml /app/share/metainfo/io.github.ergolyam.Drosophila.metainfo.xml
    sources:
      - type: dir
        path: ..
